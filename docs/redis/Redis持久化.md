# Redis持久化

- 支持两种持久化方式
  - RDB方式
  - AOF方式

> 以下命令均不区分大小写

## RDB方式

- rdb方式的持久化是通过快照完成的

> 当符合一定条件时，Redis会自动将内存中的所有数据生成一份副本并保存到磁盘上，这个过程即为“快照”

### 如何触发

分以下几种情况执行：

- 根据配置规则进行自动快照

  配置文件中已经预设了3个条件：

  ```
  save 900 1
  save 300 10
  save 60 10000
  ```

  每个快照条件占一行，以 save 开头，秒数 + 被修改的键（以上），条件之间是“或”的关系

- 用户执行 save 或 bgsave 命令

  手动执行快照，区别在于save是同步执行快照，当数据过多时，会阻塞服务器，导致Redis长时间不响应（生产环境尽量避免此操作），bgsave是以后台异步的方式执行快照操作，可以用 lastsave 查看最近一次快照执行成功的时间戳。

- 执行 flashall 命令

  flashall 操作会清空数据库的所有数据，需要注意的是此时只要自动快照条件不为空，就会自动执行一次快照操作，无论自动快照条件满不满足。

- 执行复制（replication）时



### 快照原理





